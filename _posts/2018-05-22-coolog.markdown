---
title: iOSä¸€ä¸ªçµæ´»å¯æ‰©å±•çš„å¼€æºLogåº“
author: Yao Li
author_site: http://blog.yaoli.site
---

> ç›®å‰å¤§éƒ¨åˆ†iOSçš„å°å‹å¼€å‘å›¢é˜Ÿéƒ½ä¸æ˜¯å¾ˆé‡è§†logï¼Œå¯¼è‡´å¾ˆå¤šçº¿ä¸Šå‘ç”Ÿçš„æˆ–è€…ç”¨æˆ·åé¦ˆçš„bugéš¾ä»¥æ’æŸ¥ã€‚å¯¹äºAppæ¥è¯´ä¸€ä¸ªå¥½çš„æ—¥å¿—ç³»ç»Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç”¨æœ€å°çš„ä»£ä»·æ¥æ’æŸ¥ä¸€äº›ç–‘éš¾bugï¼Œæˆ‘ä»¬å”¯ä¸€è¦åšçš„å°±æ˜¯åœ¨åˆé€‚çš„ä½ç½®æ‰“å°æ—¥å¿—ï¼Œè®°å½•Appçš„è¿è¡ŒçŠ¶å†µã€‚è¿™æ ·åšä¸ä»…ä»…å¯ä»¥è®©æˆ‘ä»¬åœ¨debugæ—¶æŸ¥çœ‹Appè¿è¡Œæ—¥å¿—ï¼Œè¿˜å¯ä»¥å…è®¸Appé€šè¿‡æŸäº›æ–¹å¼å°†æ—¥å¿—æ–‡ä»¶å›ä¼ ä¾›å¼€å‘äººå‘˜åˆ†æé—®é¢˜ã€‚

## å…³äºNSLog

è‹¹æœæä¾›çš„```NSLog```æ˜¯å¤§å¤šæ•°å¼€å‘è€…å¸¸ç”¨çš„æ—¥å¿—å·¥å…·ï¼Œä½†æ˜¯```NSLog```è¿˜æ˜¯æ— æ³•æ»¡è¶³æˆ‘ä»¬å¯¹äºLogçš„å…¶ä»–éœ€æ±‚ï¼Œå¦‚æ—¥å¿—åˆ†çº§ã€æ—¥å¿—æŒä¹…åŒ–ç­‰ã€‚å¦å¤–æˆ‘ä»¬çŸ¥é“```NSLog```å…¶å®å¹¶ä¸æ˜¯```printf```çš„å°è£…è€Œæ˜¯ASLçš„é«˜çº§å°è£…ï¼Œè‹¹æœåœ¨æ–‡æ¡£ä¸Šä¹Ÿè¯´æ˜äº†```NSLog```çš„è®¾è®¡ç›®çš„æ˜¯```Logs an error message```ï¼Œå› æ­¤æˆ‘ä»¬å¦‚æœåœ¨å¼€å‘ä¸­å¤§é‡ä½¿ç”¨```NSLog```ï¼ŒAppçš„æ€§èƒ½ä¼šå˜å¾—éå¸¸ç³Ÿç³•ã€‚å…³äºNSLogçš„æ€§èƒ½é—®é¢˜å¯ä»¥å‚çœ‹è¿™ç¯‡sunnyxxçš„æ–‡ç« [ã€NSLogæ•ˆç‡ä½ä¸‹çš„åŸå› åŠå°è¯•lldbæ–­ç‚¹æ‰“å°Logã€‘](https://blog.sunnyxx.com/2014/04/22/objc_dig_nslog/)

## éœ€æ±‚

* ç‹¬ç«‹å¼€å…³ã€‚æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›åœ¨debugç‰ˆæœ¬ä¸­æ‰“å¼€æ§åˆ¶å°logå’Œæ–‡ä»¶logï¼Œåœ¨releaseç‰ˆæœ¬ä¸­åªæ‰“å¼€æ–‡ä»¶logçš„åŠŸèƒ½ã€‚
* å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚æˆ‘ä»¬çŸ¥é“åœ¨iOS10ä»¥åè‹¹æœå»ºè®®ä½¿ç”¨```os.log```æ¥å–ä»£```NSLog```ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªå…·æœ‰å¾ˆå¼ºæ‰©å±•æ€§çš„logåº“ï¼Œä½¿æˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“åœ°å°†logåº•å±‚å®ç°æ›¿æ¢ä¸º```os.log```è€Œä¸å¿…æ”¹å˜åŸæœ‰çš„logä»£ç ã€‚
* è‡ªå®šä¹‰æ ¼å¼ã€‚å¯ä»¥è‡ªå®šä¹‰logè¾“å‡ºçš„æ ‡å‡†æ ¼å¼ï¼ŒåŒæ—¶ä¹Ÿä¸å¸Œæœ›åŸæœ‰çš„logè°ƒç”¨æ¥å£æœ‰å¤§é‡æ”¹åŠ¨ã€‚
* æ—¥å¿—æŸ¥çœ‹å·¥å…·ã€‚æˆ‘ä»¬çŸ¥é“```NSLog```åœ¨Macæä¾›äº†```Console.app```è¿™æ ·çš„è°ƒè¯•å·¥å…·ï¼Œä½¿å¾—æˆ‘ä»¬å³ä½¿ä¸åœ¨xcodeçš„debugæ¨¡å¼ä¸‹ä¹Ÿå¯ä»¥éšæ—¶æŸ¥çœ‹Appçš„æ—¥å¿—ã€‚ç”šè‡³ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨windows PCä¹Ÿå¯ä»¥åœ¨édebugæ¨¡å¼ä¸‹æŸ¥çœ‹logã€‚
* åˆ†çº§ä¸è¿‡æ»¤ã€‚logåº”è¯¥è¢«åˆ’åˆ†ä¸ºä¸åŒç­‰çº§ï¼ŒåŒæ—¶åœ¨debugå’Œreleaseä¸‹æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸åŒçº§åˆ«çš„è¿‡æ»¤å™¨ï¼Œä½çº§åˆ«çš„logå¯ä»¥è¢«è¿‡æ»¤æ‰ã€‚ä¸¾ä¸ªğŸŒ°ï¼šå‡å¦‚æœ‰infoã€defaultã€warningã€errorå››ä¸ªç­‰çº§logï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ›åœ¨debugä¸‹è¾“å‡ºæ‰€æœ‰ç­‰çº§çš„logï¼Œè€Œåœ¨releaseä¸‹åªè¾“å‡ºwarningå’Œerrorç­‰çº§çš„logã€‚

## è½®å­

### å…ˆä¸Šè½®å­[Coolog[Github]](https://github.com/RyanLeeLY/Coolog)

Coologè®¾è®¡ä¹‹åˆå°±æ˜¯ä¸ºäº†è§£å†³ä¸Šé¢æ‰€æåˆ°çš„è¿™äº›éœ€æ±‚ã€‚Coologå…·æœ‰é«˜åº¦çš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ªæµè§ˆå™¨çš„è°ƒè¯•å·¥å…·ã€‚ç›®å‰ï¼ŒCoologè¿˜æœ‰å¾ˆå¤šéœ€è¦å®Œå–„çš„åœ°æ–¹ï¼ŒåŒ…æ‹¬æµè§ˆå™¨è°ƒè¯•å·¥å…·ç›®å‰ä¹Ÿåªæ˜¯ä¸€ä¸ªdemoï¼Œæ¬¢è¿å¤§å®¶æˆä¸ºCoologçš„Contributorã€‚

## æ¶æ„
ä¸ºäº†ä¿è¯å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼ŒCoologåŒ…å«äº†äº†ç”Ÿæˆå™¨ï¼ˆCOLLoggerï¼‰ã€æ ¼å¼åŒ–åè®®ä¸æ ¼å¼åŒ–å™¨ï¼ˆCOLFormatableå’ŒCOLLogFormatterï¼‰ã€é©±åŠ¨å™¨ï¼ˆCOLLoggerDriverï¼‰ã€å¼•æ“ï¼ˆCOLEngineï¼‰ã€ç®¡ç†è€…ï¼ˆCOLLogManagerï¼‰ï¼Œä»–ä»¬ä¹‹é—´çš„å…³ç³»å¯è§ä¸‹å›¾ï¼š
![Architecture](https://user-gold-cdn.xitu.io/2018/5/22/16387f7dfcdaafe8?w=700&h=525&f=jpeg&s=120233)

ä¸‹é¢æˆ‘ä»¬æ¥ä¸€ä¸€è¯´æ˜å®ƒä»¬å„è‡ªçš„ä½œç”¨ã€‚
### ç”Ÿæˆå™¨ COLLogger
é¡¾åæ€ä¹‰ï¼Œç”Ÿæˆå™¨è´Ÿè´£æœ€ç»ˆlogçš„ç”Ÿæˆï¼Œ```COLLogger```æ˜¯ä¸€ä¸ªåè®®ã€‚Coologæä¾›äº†ä¸‰ç§ç”Ÿæˆå™¨ï¼Œåˆ†åˆ«æ˜¯```COLNSLogger```ã€```COLConsoleLogger```ã€```COLFileLogger```ï¼Œè¿™ä¸‰ä¸ªç±»éƒ½å®ç°äº†```COLLogger```åè®®ä¸­```- (void)log:(NSString *)logString;```è¿™ä¸ªæ–¹æ³•ã€‚åœ¨è¯¥æ–¹æ³•ä¸­æˆ‘ä»¬æœ€ç»ˆå®šä¹‰äº†è¿™ä¸ªç±»å‹çš„logæœ€åçš„ç”Ÿæˆæ–¹æ³•ï¼Œlogå¼•æ“ä¼šé€šè¿‡é©±åŠ¨å™¨è°ƒç”¨åˆ°è¯¥æ–¹æ³•è¾“å‡ºlogã€‚
é™¤äº†è¿™ä¸‰ç§ç”Ÿæˆå™¨ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®ç°```COLLogger```åè®®æ¥è‡ªå®šä¹‰ä¸€ä¸ªç”Ÿæˆå™¨ã€‚

### æ ¼å¼åŒ–åè®® COLFormatable
è¿™ä¸ªåè®®åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å®šä¹‰äº†logçš„è¾“å‡ºæ ¼å¼ã€‚
```objective-c
- (NSString *)completeLogWithType:(COLLogType)type
                              tag:(NSString *)tag
                          message:(NSString *)message
                             date:(NSDate *)date;
```

### æ ¼å¼åŒ–å™¨ COLLogFormatter
æ ¼å¼åŒ–å™¨å°±æ˜¯å®ç°äº†```COLFormatable```æ ¼å¼åŒ–åè®®çš„ç±»ï¼Œé»˜è®¤æˆ‘ä»¬æä¾›äº†ä¸ä¸Šè¿°ä¸‰ç§ç”Ÿæˆå™¨å¯¹åº”çš„ä¸‰ç§æ ¼å¼åŒ–å™¨```NSLogFormatter```ã€```ConsoleFormatter```ã€```FileFormatter```ï¼Œä»–ä»¬åˆ†åˆ«å¯¹åº”åŸç”ŸNSLogã€æ§åˆ¶å°ä¸æµè§ˆå™¨å·¥å…·logå’Œæ–‡ä»¶logã€‚è¿™ä¸ªä¸‰ä¸ªç±»æˆ‘ä»¬ä½¿ç”¨äº†ç±»æ—æä¾›å·¥å‚æ–¹æ³•å®Œæˆåˆå§‹åŒ–ï¼Œåœ¨è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨æ—¶å¹¶ä¸éœ€è¦ç»§æ‰¿```COLLogFormatter```ï¼Œæ˜¯éœ€è¦å®ç°```COLFormatable```åè®®å³å¯ã€‚

### é©±åŠ¨å™¨ COLLoggerDriver
é©±åŠ¨å™¨æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œç”Ÿæˆå™¨ä¸æ ¼å¼åŒ–å™¨å°†ä½œä¸ºä¾èµ–æ³¨å…¥åˆ°é©±åŠ¨å™¨ä¸­ï¼ŒåŒæ—¶é©±åŠ¨å™¨è´Ÿè´£logçš„çº§åˆ«çš„é…ç½®ï¼Œå®ç°logåˆ†çº§è¿‡æ»¤ã€‚logç±»å‹åˆ†ä¸º5ä¸­ï¼š```Error>Warning>Info>Default>Debug```ï¼Œè¿‡æ»¤çš„çº§åˆ«åˆ†ä¸º7çº§ï¼š```LevelOff>LevelError>LevelWarning>LevelInfo>LevelDefault>LevelDebug>LevelAll```ï¼Œä½çº§åˆ«çš„logå¯èƒ½ä¼šè¢«è¿‡æ»¤ï¼Œæ¯”å¦‚å¦‚æœå½“å‰è¿‡æ»¤çº§åˆ«ä¸º```LevelInfo```ï¼Œé‚£ä¹ˆå°†åªæœ‰```Error```ã€```Warning```ã€```Info ```è¿™ä¸‰ç§ç±»å‹çš„logä¼šè¢«è¾“å‡ºã€‚æœ€ç»ˆé©±åŠ¨å™¨å°†äº¤ç”±logå¼•æ“ç»Ÿä¸€ç®¡ç†ã€‚

#### å¼•æ“ COLEngine
å¼•æ“è´Ÿè´£ç®¡ç†æ‰€æœ‰çš„é©±åŠ¨å™¨ï¼Œç”±å®ƒè´Ÿè´£å¯åŠ¨logï¼Œå¼•æ“å¯ä»¥éšæ—¶ç§»é™¤æˆ–è€…åŠ å…¥å•ä¸ªlogé©±åŠ¨å™¨ï¼Œå®ç°ä¸åŒlogçš„ç‹¬ç«‹å¼€å…³ã€‚

## ä½¿ç”¨

### åˆå§‹åŒ–

```objective-c
[[COLLogManager sharedInstance] setup];
    
[[COLLogManager sharedInstance] enableFileLog];  // æ‰“å¼€æ–‡ä»¶log
[[COLLogManager sharedInstance] enableConsoleLog];  // æ‰“å¼€æ§åˆ¶å°log
//    [[COLLogManager sharedInstance] enableNSLog];  // ä¸€èˆ¬æ§åˆ¶å°logå’ŒNSLogä¸åŒæ—¶æ‰“å¼€
    
// Debugä¸‹æ‰“å¼€æ‰€æœ‰çº§åˆ«logï¼ŒReleaseä¸‹æ‰“å¼€Infoçº§åˆ«ä»¥ä¸Šçš„log
#ifdef DEBUG
    [COLLogManager sharedInstance].level = COLLogLevelAll;
#else
    [COLLogManager sharedInstance].level = COLLogLevelInfo;
#endif
```

### Log

```objective-c
CLogError(@"tag", @"%@", @"log content");
CLogE(@"%@", @"log content");

CLogWarning(@"tag", @"%@", @"log content");
CLogW(@"%@", @"log content");
	
CLogInfo(@"tag", @"%@", @"log content");
CLogI(@"%@", @"log content");
	
CLogDefault(@"tag", @"%@", @"log content");
CLog(@"%@", @"log content");
	
CLogDebug(@"tag", @"%@", @"log content");
CLogD(@"%@", @"log content");
```

### æµè§ˆå™¨è°ƒè¯•
é¦–å…ˆæ‰“å¼€æµè§ˆå™¨è°ƒè¯•åŠŸèƒ½ã€‚
```objective-c
[[COLLogManager sharedInstance] enableRemoteConsole];
```
å°†ç”µè„‘å’Œæ‰‹æœºè¿åˆ°åŒä¸€ä¸ªwifiä¸‹ï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®[(http://coolog.oss-cn-hangzhou.aliyuncs.com/index.html?host=ws://[YourPhoneIPAddr]:9001/coolog](http://coolog.oss-cn-hangzhou.aliyuncs.com/index.html?host=ws://[YourPhoneIPAddr]:9001/coolog)ï¼Œæ³¨æ„åœ°å€åé¢çš„å‚æ•°[YourPhoneIPAddr]æ›¿æ¢ä¸ºæ‰‹æœºçš„IPåœ°å€ã€‚

ç›®å‰æ•ˆæœæ˜¯ä¸‹é¢è¿™æ ·ã€‚
![BrowserTool](https://user-gold-cdn.xitu.io/2018/5/22/16387f7e00e2acea?w=1114&h=708&f=gif&s=2920997)

### åŠ å…¥è‡ªå®šä¹‰çš„logæ–¹æ³•
* ç¬¬ä¸€æ­¥ï¼šå®ç°ä¸€ä¸ªç”Ÿæˆå™¨

```objective-c
#import "COLLogger.h"
@interface MyLogger : NSObject <COLLogger>

@end
```

```objective-c
#import "MyLogger.h"
#import <os/log.h>

@implementation MyLogger
@synthesize formatterClass = _formatterClass;

+ (instancetype)logger {
    return [[MyLogger alloc] init];
}

// This is your own log method. It will be called by log engine. 
- (void)log:(NSString *)logString {
	//For example, here below uses os_log as its implementation.
    os_log(OS_LOG_DEFAULT, "%{public}s", [logString UTF8String]);
}
@end
```

* ç¬¬äºŒæ­¥ï¼šå®ç°ä¸€ä¸ªæ ¼å¼åŒ–å™¨

```objective-c
#import "COLLogFormatter.h"

@interface MyLogFormatter : NSObject <COLFormatable>

@end
```

```objective-c
#import "MyLogFormatter.h"

@implementation MyLogFormatter
// The log's format depends on this method.
- (NSString *)completeLogWithType:(COLLogType)type tag:(NSString *)tag message:(NSString *)message date:(NSDate *)date {
    return [NSString stringWithFormat:@"tag=[%@], type=[%zd], message=[%@], date=[%@]", tag, type, message, date];
}
@end
```

* ç¬¬ä¸‰æ­¥ï¼šå®ä¾‹åŒ–é©±åŠ¨å™¨å¹¶åŠ å…¥åˆ°logå¼•æ“

```objective-c
COLLoggerDriver *myDriver = [[COLLoggerDriver alloc] initWithLogger:[MyLogger logger]
                                                              formatter:[[MyLogFormatter alloc] init]
                                                                  level:COLLogLevelInfo];
[[COLLogManager sharedInstance].logEngine addDriver:myDriver];
```

## åè®°
Logæ˜¯æˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­å®¹æ˜“å¿½ç•¥çš„ä¸€æ­¥ï¼Œä½†å®ƒåˆæ˜¯ååˆ†é‡è¦çš„ä¸€é¡¹å·¥ä½œï¼Œæˆ‘ä»¬è¦å­¦ä¼šå¦‚ä½•åœ¨åˆé€‚çš„ä½ç½®è®°å½•åˆé€‚logï¼Œè¿™å¯¹äºæˆ‘ä»¬å¤ç°å’Œæ’æŸ¥é—®é¢˜çœŸçš„æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚

ç›®å‰Coologè¿˜æ˜¯å¾ˆæœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼ŒåŒ…æ‹¬æµè§ˆå™¨è°ƒè¯•å·¥å…·ä¹Ÿæ˜¯ä¸€ä¸ªåˆçº§çš„demoçŠ¶æ€ï¼Œåç»­å·¥ä½œä¼šæ”¾åœ¨logçš„æ€§èƒ½ä¼˜åŒ–å’Œè°ƒè¯•å·¥å…·çš„æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½ï¼ŒåŒ…æ‹¬è°ƒè¯•å·¥å…·çš„UIä¹Ÿä¼šè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚
